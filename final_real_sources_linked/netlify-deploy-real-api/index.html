<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>台股金融 Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 正確 CSS (Vite 輸出檔) -->
  <link rel="stylesheet" href="./assets/index-DkxZYwTq.css" />

  <!-- Module Preload for JS -->
  <link rel="modulepreload" href="./assets/index-B4pZZ_yq.js" />
</head>
<body>
  <div id="app"></div>

  <!-- 1) 先載設定檔 -->
  <script defer src="./config.js"></script>

  <!-- 2) fetch 攔截器 -->
<script>
(function () {
  const ORIG_FETCH = window.fetch.bind(window);
  const map = {
    'data/taiwan-keywords.json': '/.netlify/functions/stock-trends?mode=tw',
    'data/industry-news.json': '/.netlify/functions/news?mode=industry',
    'data/us-economic-news.json': '/.netlify/functions/news?mode=us_economic',
    'data/us-indices.json': '/.netlify/functions/usindices'
  };

  window.fetch = async function (input, init) {
    const url = (typeof input === 'string') ? input : (input && input.url) || '';
    const target = Object.keys(map).find(k => url.includes(k));
    const realUrl = target ? map[target] : url;

    try {
      const res = await ORIG_FETCH(realUrl, init);
      const data = await res.json().catch(() => ({}));

      if (data && data.ok) {
        return new Response(JSON.stringify(data.data), {
          status: 200,
          headers: { 'content-type': 'application/json' }
        });
      } else {
        console.warn('[fetch fallback]', realUrl, data?.error);
        // 保底輸出一個安全結構，避免前端爆掉
        return new Response(JSON.stringify({
          indices: [],
          keywords: [],
          items: []
        }), {
          status: 200,
          headers: { 'content-type': 'application/json' }
        });
      }
    } catch (e) {
      console.error('[fetch error]', e);
      return new Response(JSON.stringify({
        indices: [],
        keywords: [],
        items: []
      }), {
        status: 200,
        headers: { 'content-type': 'application/json' }
      });
    }
  };

  console.log('[OK] safe interceptors installed');
})();
</script>



  <!-- 3) 全域錯誤護欄 -->
  <script>
    window.addEventListener('error', e => {
      console.error('[GlobalError]', e.error || e.message || e);
    });
    window.addEventListener('unhandledrejection', e => {
      console.error('[PromiseRejection]', e.reason || e);
    });
  </script>

  <!-- 4) 主程式 (Vite 打包輸出檔) -->
  <script type="module" crossorigin src="./assets/index-B4pZZ_yq.js"></script>
</body>
</html>
